<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Phone WebRTC Answer</title>
  </head>
  <body style="font-family: sans-serif; padding: 1rem;">
    <h2>Phone Side</h2>
    <p>Paste the offer JSON from the desktop below:</p>
    <textarea id="offer" rows="8" style="width: 100%; font-size: 0.8rem"></textarea>
    <button id="connect">Generate Answer</button>

    <h3>Copy this Answer JSON back to desktop:</h3>
    <textarea id="answer" rows="8" style="width: 100%; font-size: 0.8rem"></textarea>

    <h3>Messages</h3>
    <div
      id="messages"
      style="background: #eee; padding: 1rem; height: 150px; overflow-y: auto;"
    ></div>
    <input
      type="text"
      id="messageInput"
      placeholder="Type message..."
    />
    <button id="sendMessage">Send</button>

    <script>
      let pc;
      let dataChannel;

      document.getElementById("connect").onclick = async () => {
        const offerText = document.getElementById("offer").value;
        if (!offerText) {
          alert("Paste the desktop offer JSON first!");
          return;
        }

        const offer = JSON.parse(offerText);

        // Create RTCPeerConnection
        pc = new RTCPeerConnection({
          iceServers: [{ urls: "stun:stun.l.google.com:19302" }],
        });

        pc.ondatachannel = (event) => {
          dataChannel = event.channel;
          dataChannel.onmessage = (e) => {
            const messages = document.getElementById("messages");
            messages.innerHTML += `<div>Desktop: ${e.data}</div>`;
          };
        };

        pc.onicecandidate = (event) => {
          if (event.candidate) {
            console.log("Phone ICE candidate:", event.candidate);
          }
        };

        await pc.setRemoteDescription(offer);

        const answer = await pc.createAnswer();
        await pc.setLocalDescription(answer);

        document.getElementById("answer").value = JSON.stringify(answer);
      };

      document.getElementById("sendMessage").onclick = () => {
        const input = document.getElementById("messageInput");
        if (dataChannel && input.value.trim() !== "") {
          dataChannel.send(input.value);
          const messages = document.getElementById("messages");
          messages.innerHTML += `<div>You: ${input.value}</div>`;
          input.value = "";
        }
      };
    </script>
  </body>
</html>
